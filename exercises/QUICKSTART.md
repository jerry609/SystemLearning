# 快速开始指南

欢迎！这个指南将帮助你快速开始 HPFS Bug 学习练习。

## 🎯 5 分钟快速了解

### 这个 Bug 是什么？

HPFS (High Performance File Service) 的流量控制代码存在一个并发 bug：

```
两个并发任务共享一个全局 channel
    ↓
第一个任务完成时关闭该 channel
    ↓
第二个任务仍在使用，尝试读取
    ↓
💥 Panic: send on closed channel
```

### 为什么重要？

- 这是一个**真实的生产环境 bug**
- 影响 PolarDB-X 的备份功能
- 典型的**并发资源管理错误**
- 学习价值高，可应用到其他项目

### 你将学到什么？

1. ✅ 理解并发 bug 的根本原因
2. ✅ 掌握 Go 并发调试技术
3. ✅ 实现 3 种不同的修复方案
4. ✅ 编写并发安全的代码
5. ✅ 端到端的问题解决能力

---

## 🚀 立即开始

### 步骤 1: 选择学习路径 (1 分钟)

根据你的时间和目标选择：

**🟢 初学者路径** (8-12 小时)
- 适合：第一次接触这类 bug
- 目标：理解 bug 并实现一种修复方案
- 模块：1, 2, 4 (方案 A), 5 (基础), 7

**🟡 进阶路径** (16-20 小时)
- 适合：有一定并发经验
- 目标：完全掌握，实现所有方案
- 模块：全部 7 个模块

**🔴 专家路径** (20+ 小时)
- 适合：想要深入研究
- 目标：设计新架构，指导他人
- 模块：全部 + 扩展项目

**我选择**: _____________ 路径

### 步骤 2: 阅读背景资料 (10 分钟)

快速浏览以下文档，了解 bug 的基本情况：

1. **必读** (5 分钟):
   - [Bug README](../review/HPFS_BUG_README.md) - 快速概览
   - [Bug 流程图](../review/HPFS_BUG_FLOW_DIAGRAM.md) - 可视化理解

2. **推荐** (5 分钟):
   - [Bug 详细分析](../review/HPFS_FLOW_CONTROL_BUG_ANALYSIS.md) - 深入分析

3. **可选**:
   - [Bug 修复指南](../review/HPFS_BUG_FIX_GUIDE.md) - 修复方案
   - [Bug 复现指南](../review/HPFS_BUG_REPRODUCTION_GUIDE.md) - 复现步骤

### 步骤 3: 开始第一个练习 (30 分钟)

打开 `module1/flowcontrol_annotated.go`，开始标注代码中的问题点。

```bash
# 在编辑器中打开
code exercises/module1/flowcontrol_annotated.go

# 或使用你喜欢的编辑器
vim exercises/module1/flowcontrol_annotated.go
```

**任务**:
1. 阅读代码
2. 找到所有 `TODO` 标记
3. 在注释中写下你的理解
4. 回答代码末尾的问题

---

## 📋 学习检查清单

### 开始前

- [ ] 安装 Go 1.21+
- [ ] 选择学习路径
- [ ] 阅读背景资料
- [ ] 创建学习笔记文件

### 模块 1: Bug 根因分析

- [ ] 完成代码注释练习
- [ ] 完成时序分析练习
- [ ] 完成问答测试 (得分 >= 80)
- [ ] 完成数据流图练习

**预计时间**: 2-3 小时

### 模块 2: 触发条件研究

- [ ] 编写最小复现程序
- [ ] 运行参数调优实验
- [ ] 分析日志样本

**预计时间**: 2-3 小时

### 模块 3: 并发调试技术

- [ ] 使用 Race Detector
- [ ] 分析 Stack Trace
- [ ] 添加调试日志
- [ ] 使用 pprof 分析

**预计时间**: 2-3 小时

### 模块 4: 实现修复方案

- [ ] 实现方案 A (禁用全局流控)
- [ ] 实现方案 B (引用计数)
- [ ] 实现方案 C (rate.Limiter)
- [ ] 对比三种方案

**预计时间**: 3-4 小时

### 模块 5: 编写测试用例

- [ ] 编写单元测试
- [ ] 编写并发压力测试
- [ ] 编写 Table-Driven Tests
- [ ] 分析测试覆盖率

**预计时间**: 2-3 小时

### 模块 6: 并发安全模式

- [ ] 学习 Channel 关闭模式
- [ ] 学习 Context 使用模式
- [ ] 创建并发安全检查清单
- [ ] 配置静态分析工具

**预计时间**: 2-3 小时

### 模块 7: 端到端实践

- [ ] 部署测试环境
- [ ] 触发 bug
- [ ] 应用修复
- [ ] 验收测试

**预计时间**: 3-4 小时

---

## 💡 学习技巧

### 有效学习方法

1. **主动学习**: 不要只是阅读，动手写代码
2. **记录笔记**: 在 `PROGRESS.md` 中记录你的思考
3. **先思考再看答案**: 独立完成练习后再查看答案
4. **实践验证**: 运行代码，观察实际行为
5. **对比分析**: 对比修复前后的差异

### 遇到困难时

1. **查看提示**: 每个练习都有提示和参考资料
2. **查看答案**: `answers/` 目录有详细解析
3. **查看文档**: `review/` 目录有完整的 bug 分析
4. **使用工具**: Go race detector, pprof 等
5. **记录问题**: 在 `PROGRESS.md` 中记录困难和解决方案

### 时间管理

- **每次学习 1-2 小时**: 保持专注
- **完成一个模块再继续**: 不要跳跃
- **定期复习**: 每周回顾学过的内容
- **设置里程碑**: 每完成一个模块庆祝一下

---

## 🛠️ 工具准备

### 必需工具

```bash
# 检查 Go 版本
go version  # 应该 >= 1.21

# 安装依赖
go get golang.org/x/time/rate
```

### 推荐工具

```bash
# 代码编辑器
# - VS Code + Go 插件
# - GoLand
# - Vim/Neovim + vim-go

# 调试工具
go install golang.org/x/tools/cmd/godoc@latest
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
```

### 可选工具 (模块 7 需要)

```bash
# Kubernetes 环境
# - minikube
# - kubectl
# - Docker

# 安装 minikube (macOS)
brew install minikube

# 安装 kubectl
brew install kubectl
```

---

## 📊 进度跟踪

### 使用进度文件

打开 `PROGRESS.md` 文件，记录你的学习进度：

```bash
code exercises/PROGRESS.md
```

每完成一个练习，勾选对应的复选框，记录：
- 完成时间
- 得分（如果有测试）
- 关键收获
- 遇到的困难

### 自我评估

完成每个模块后，问自己：
- ✅ 我理解了这个模块的核心概念吗？
- ✅ 我能向别人解释这个概念吗？
- ✅ 我能应用到其他项目吗？

如果有任何一个答案是"不确定"，建议重新学习该模块。

---

## 🎓 学习目标

### 完成后你将能够

**理解层面**:
- 解释 HPFS Bug 的根本原因
- 识别类似的并发问题
- 理解 Go 并发的陷阱

**技能层面**:
- 使用 Go 调试工具
- 编写并发安全的代码
- 实现多种修复方案
- 编写高质量的测试

**应用层面**:
- 在实际项目中预防类似问题
- 进行并发代码审查
- 指导团队成员
- 设计并发安全的架构

---

## 📞 获取帮助

### 资源

- **FAQ**: `exercises/FAQ.md`
- **答案**: `exercises/answers/`
- **文档**: `review/` 目录
- **官方资源**: [Go 官方文档](https://go.dev/doc/)

### 社区

- [Go Forum](https://forum.golangbridge.org/)
- [Go Slack](https://gophers.slack.com/)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/go)

---

## ✅ 准备好了吗？

如果你已经：
- [x] 选择了学习路径
- [x] 阅读了背景资料
- [x] 准备好工具
- [x] 打开了 `PROGRESS.md`

那么，开始第一个练习吧！

```bash
# 打开第一个练习
code exercises/module1/flowcontrol_annotated.go
```

**祝学习愉快！** 🎉

记住：这不仅仅是学习一个 bug，而是掌握并发编程的重要技能。

---

## 📅 建议学习计划

### 第 1 周: 理解和复现

- **Day 1-2**: 模块 1 (Bug 根因分析)
- **Day 3-4**: 模块 2 (触发条件研究)
- **Day 5**: 复习和总结

### 第 2 周: 调试和修复

- **Day 1-2**: 模块 3 (并发调试技术)
- **Day 3-5**: 模块 4 (实现修复方案)

### 第 3 周: 测试和预防

- **Day 1-2**: 模块 5 (编写测试用例)
- **Day 3-4**: 模块 6 (并发安全模式)
- **Day 5**: 复习和总结

### 第 4 周: 实践和总结

- **Day 1-3**: 模块 7 (端到端实践)
- **Day 4**: 完整复习
- **Day 5**: 撰写学习总结

---

**现在就开始吧！** 💪
