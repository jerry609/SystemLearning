# Lab 19: 构建自主智能体 - ReAct框架与工具使用

## 🎯 学习目标

这是对您之前所有知识的终极集成与应用。在本实验中，您将超越传统的"问答式"AI，亲手构建一个能够与外部世界交互、能够使用工具来完成复杂任务的**自主智能体（Autonomous Agent）**。您将学习和实践当前构建Agent最主流的框架——**ReAct (Reason + Act)**。

## 核心任务

1.  **理论学习：ReAct框架的核心循环**
    *   **Agent的定义**: 理解什么是AI Agent？它与普通LLM的核心区别在于其**主动性**和**与环境交互**的能力。
    *   **ReAct的核心思想**: 深入理解 **"思考（Reason）"** 与 **"行动（Act）"** 相结合的强大威力。LLM不再是一个封闭的文本生成器，而是成为了一个中央控制器，它通过一个"**思考 -> 行动 -> 观察**"的循环来驱动任务的解决。
        -   `Thought`: 模型首先对当前任务和已有信息进行分析，规划下一步该做什么。
        -   `Action`: 模型决定调用一个外部工具来获取新信息或执行操作。
        -   `Observation`: 模型接收来自工具的返回结果，作为下一次"思考"的输入。

2.  **赋予模型使用工具的能力**
    *   **定义工具集**: 为您的LLM编写几个简单的Python函数作为"工具箱"。工具的接口必须清晰、稳定。
        - 示例工具1: **网络搜索器** `search_web(query: str) -> str`
        - 示例工具2: **计算器** `calculator(expression: str) -> float`
        - 示例工具3 (可选): **代码解释器** `python_interpreter(code: str) -> str`
    *   **设计工具提示 (Tool Prompt)**: 设计一个精巧的系统提示（System Prompt），向LLM清晰地描述它有哪些可用的工具、每个工具的功能是什么、以及调用工具的格式（例如，使用特定的XML标签或JSON格式）。

3.  **实现ReAct主控循环**
    *   **构建主循环**: 这是本实验的核心代码。这个循环负责：
        1.  将用户的**最终目标**和**历史交互记录**（`Thought`, `Action`, `Observation`）组装成一个完整的上下文，发送给LLM。
        2.  调用LLM进行推理，获得包含新`[Thought]`和`[Action]`的响应。
        3.  编写一个**响应解析器**，从LLM的文本输出中准确地解析出需要调用的工具名称和参数。
        4.  根据解析结果，**执行对应的Python工具函数**。
        5.  将工具的执行结果封装成`[Observation]`，追加到历史记录中，准备下一次循环。
        6.  设定一个终止条件（例如，LLM输出了`[Final Answer]`或达到了最大循环次数）。

4.  **端到端任务验证**
    *   **设计一个无法仅靠LLM自身知识解决的任务**。
    *   **示例任务**: "苹果公司（AAPL）和英伟达公司（NVDA）当前的总市值之和是多少美元？"
        - **预期智能体行为**:
            1.  `Thought`: 我需要分别查到两家公司的市值，然后用计算器把它们加起来。
            2.  `Action`: `search_web("AAPL market cap")` -> `Observation`: (返回结果)
            3.  `Thought`: 好的，我知道了苹果的市值。现在查英伟达的。
            4.  `Action`: `search_web("NVDA market cap")` -> `Observation`: (返回结果)
            5.  `Thought`: 我已经获得了两个市值，现在需要用计算器把它们加起来。
            6.  `Action`: `calculator("[苹果市值] + [英伟达市值]")` -> `Observation`: (返回计算结果)
            7.  `Thought`: 我得到了最终答案。
            8.  `[Final Answer]`: (输出最终结果)

## 📝 预期成果

- 一个基于ReAct框架、能够调用外部Python工具来完成任务的、功能完备的自主智能体。
- 深刻理解Agent系统的核心工作原理和工程挑战。
- 掌握了将大语言模型从一个"知识库"改造为一个"行动者"的关键技术。
- 具备了构建和调试初级AI Agent的能力，为您未来探索更复杂的Agent架构（如多智能体协作、长期记忆等）奠定了坚实的基础。 