# 参考答案

这个目录包含所有练习的参考答案实现。

## 使用说明

### 查看练习 1 的参考答案

```bash
cd ex1/

# 查看实现代码
cat reconcile.go

# 运行参考实现
go run .

# 运行测试
go test -v

# 只运行练习 1 的测试
go test -v -run TestExercise1
```

## 目录结构

```
solutions/
├── ex1/              # 练习 1: 状态机与基础协调循环
│   ├── reconcile.go  # 完整的状态机实现
│   ├── main.go       # 测试程序
│   └── ex1_test.go   # 单元测试
├── ex2/              # 练习 2: 资源创建与管理（待实现）
├── ex3/              # 练习 3: 更新与同步逻辑（待实现）
├── ex4/              # 练习 4: 删除与 Finalizer（待实现）
└── ex5/              # 练习 5: 错误处理与可观测性（待实现）
```

## 学习建议

1. **先自己尝试实现**：在 `framework/` 目录中编写代码
2. **遇到困难时参考**：查看这里的实现思路
3. **对比差异**：比较你的实现和参考答案的区别
4. **理解原理**：不要只是复制代码，理解为什么这样实现

## 练习 1 的关键实现点

### 1. 状态机引擎 (Reconcile 函数)

- 检查删除标记 (`DeletionTimestamp`)
- 根据 Phase 分发到不同的处理函数
- 使用 switch-case 实现状态路由

### 2. Finalizer 管理

- `hasFinalizer()`: 检查 Finalizer 是否存在
- `addFinalizer()`: 添加 Finalizer（幂等性）
- `removeFinalizer()`: 移除 Finalizer

### 3. Pending 状态处理

- 添加 Finalizer（如果不存在）
- 转换状态到 Creating
- 记录事件
- 返回 Requeue=true 立即重新处理

## 测试覆盖

每个练习的参考答案都包含完整的测试：

- **功能测试**：验证核心功能是否正确
- **边界测试**：测试边界条件和错误情况
- **集成测试**：测试多个组件的协作

## 代码质量

参考答案遵循以下原则：

- ✅ 清晰的代码结构
- ✅ 详细的注释说明
- ✅ 完整的错误处理
- ✅ 幂等性保证
- ✅ 良好的日志记录

## 下一步

完成练习 1 后，继续实现练习 2-5。每个练习的参考答案会在相应练习完成后提供。
