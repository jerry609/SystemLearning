# Lab 04: 结构型模式 - 组合、外观、桥接

## 📚 学习目标

- 掌握组合模式，学会处理树形结构和部分-整体层次结构
- 理解外观模式，学会简化复杂子系统的接口
- 掌握桥接模式，学会将抽象与实现分离，处理多维度变化
- 能够识别何时使用这三种模式解决实际问题
- 通过实战项目综合应用所学模式

## 📖 内容概览

### 1. 组合模式 (Composite Pattern)

- **定义**: 将对象组合成树形结构以表示"部分-整体"的层次结构，使客户端对单个对象和组合对象的使用具有一致性
- **应用场景**: 文件系统、组织架构、UI 组件树
- **实现方式**: 统一的组件接口，叶子节点和容器节点

### 2. 外观模式 (Facade Pattern)

- **定义**: 为子系统中的一组接口提供一个统一的高层接口，使子系统更容易使用
- **应用场景**: API 网关、系统集成、复杂库的封装
- **实现方式**: 外观类封装子系统的复杂性

### 3. 桥接模式 (Bridge Pattern)

- **定义**: 将抽象部分与实现部分分离，使它们都可以独立变化
- **应用场景**: 跨平台应用、多数据库支持、多渲染引擎
- **实现方式**: 抽象层持有实现层的引用

## 🗂️ 目录结构

```
lab04-结构型模式-组合外观桥接/
├── README.md                           # 本文件
├── theory/                             # 理论文档
│   ├── 01-composite.md                # 组合模式理论
│   ├── 02-facade.md                   # 外观模式理论
│   └── 03-bridge.md                   # 桥接模式理论
├── examples/                           # 示例代码
│   ├── composite/                     # 组合模式示例
│   │   ├── file_system.go            # 文件系统示例
│   │   └── organization.go           # 组织架构示例
│   ├── facade/                        # 外观模式示例
│   │   ├── subsystem_facade.go       # 子系统封装示例
│   │   └── api_gateway.go            # API 网关示例
│   └── bridge/                        # 桥接模式示例
│       ├── cross_platform.go         # 跨平台示例
│       └── multi_dimension.go        # 多维度变化示例
├── exercises/                          # 练习题
│   ├── exercise1.md                   # 组合模式练习
│   ├── exercise2.md                   # 外观模式练习
│   ├── exercise3.md                   # 桥接模式练习
│   └── answers/                       # 参考答案
│       ├── exercise1_answer.go
│       ├── exercise2_answer.go
│       └── exercise3_answer.go
└── project/                            # 实战项目
    ├── file-system/                   # 文件系统项目
    │   ├── README.md
    │   ├── main.go
    │   ├── filesystem.go
    │   └── filesystem_test.go
    └── api-gateway/                   # API 网关项目
        ├── README.md
        ├── main.go
        ├── gateway.go
        └── gateway_test.go
```

## 🚀 快速开始

### 1. 学习理论

按顺序阅读理论文档：
```bash
# 组合模式
cat theory/01-composite.md

# 外观模式
cat theory/02-facade.md

# 桥接模式
cat theory/03-bridge.md
```

### 2. 运行示例

```bash
# 组合模式示例
cd examples/composite
go run file_system.go
go run organization.go

# 外观模式示例
cd examples/facade
go run subsystem_facade.go
go run api_gateway.go

# 桥接模式示例
cd examples/bridge
go run cross_platform.go
go run multi_dimension.go
```

### 3. 完成练习

阅读 `exercises/` 目录下的练习题，尝试独立完成，然后对照 `answers/` 目录下的参考答案。

### 4. 实战项目

```bash
# 文件系统项目
cd project/file-system
go run main.go
go test -v

# API 网关项目
cd project/api-gateway
go run main.go
go test -v
```

## 📝 学习路径

### 初学者路径 (6-8 小时)

1. **理论学习** (2 小时)
   - 阅读三个模式的理论文档
   - 理解每个模式的定义和应用场景
   - 对比三个模式的异同

2. **示例实践** (2 小时)
   - 运行所有示例代码
   - 修改示例代码，观察行为变化
   - 尝试添加新功能

3. **练习巩固** (2 小时)
   - 完成三个练习题
   - 对照参考答案，理解设计思路

4. **项目实战** (2-4 小时)
   - 运行实战项目
   - 阅读项目代码，理解模式应用
   - 尝试扩展项目功能

### 进阶路径 (4-6 小时)

1. **快速回顾** (30 分钟)
   - 浏览理论文档，重点关注 UML 图和适用场景

2. **深入示例** (1 小时)
   - 分析示例代码的设计决策
   - 思考其他可能的实现方式

3. **独立练习** (1.5 小时)
   - 不看提示独立完成练习题
   - 对比参考答案，总结差异

4. **项目实战** (2-3 小时)
   - 深入理解项目架构
   - 实现扩展功能
   - 编写额外的测试用例

## 💡 关键概念

### 组合模式核心

- **统一接口**: 叶子节点和容器节点实现相同接口
- **递归结构**: 容器可以包含叶子或其他容器
- **透明性**: 客户端无需区分叶子和容器

### 外观模式核心

- **简化接口**: 提供高层接口，隐藏子系统复杂性
- **解耦**: 客户端与子系统解耦
- **不限制访问**: 客户端仍可直接访问子系统

### 桥接模式核心

- **分离抽象和实现**: 两者可以独立变化
- **组合优于继承**: 使用组合关系而非继承
- **多维度扩展**: 避免类爆炸问题

## 🎯 练习题预览

### 练习 1: 菜单系统 (组合模式)
设计一个餐厅菜单系统，支持菜单项和子菜单的嵌套结构。

### 练习 2: 智能家居控制器 (外观模式)
实现一个智能家居控制器，简化对灯光、空调、音响等设备的控制。

### 练习 3: 消息发送系统 (桥接模式)
设计一个消息发送系统，支持多种消息类型（普通、紧急）和多种发送方式（邮件、短信、推送）。

## 📊 学习检查清单

### 组合模式
- [ ] 理解组合模式的定义和意图
- [ ] 掌握树形结构的实现方式
- [ ] 能够识别适合使用组合模式的场景
- [ ] 理解透明性和安全性的权衡
- [ ] 完成文件系统示例的运行和分析
- [ ] 完成组织架构示例的运行和分析
- [ ] 独立完成练习 1

### 外观模式
- [ ] 理解外观模式的定义和意图
- [ ] 掌握如何封装复杂子系统
- [ ] 能够识别适合使用外观模式的场景
- [ ] 理解外观模式与适配器模式的区别
- [ ] 完成子系统封装示例的运行和分析
- [ ] 完成 API 网关示例的运行和分析
- [ ] 独立完成练习 2

### 桥接模式
- [ ] 理解桥接模式的定义和意图
- [ ] 掌握抽象与实现分离的技巧
- [ ] 能够识别适合使用桥接模式的场景
- [ ] 理解桥接模式如何避免类爆炸
- [ ] 完成跨平台示例的运行和分析
- [ ] 完成多维度变化示例的运行和分析
- [ ] 独立完成练习 3

### 综合应用
- [ ] 理解三个模式的异同和适用场景
- [ ] 完成文件系统实战项目
- [ ] 完成 API 网关实战项目
- [ ] 能够在实际项目中选择合适的模式

## 🔗 相关资源

### 推荐阅读

1. **《设计模式：可复用面向对象软件的基础》** - GoF
   - 第 4 章：结构型模式

2. **《Head First 设计模式》**
   - 组合模式章节
   - 外观模式章节

3. **在线资源**
   - [Refactoring.Guru - Composite Pattern](https://refactoring.guru/design-patterns/composite)
   - [Refactoring.Guru - Facade Pattern](https://refactoring.guru/design-patterns/facade)
   - [Refactoring.Guru - Bridge Pattern](https://refactoring.guru/design-patterns/bridge)

### 开源项目示例

1. **组合模式**
   - Go AST (抽象语法树)
   - HTML DOM 树

2. **外观模式**
   - Kubernetes Client-Go
   - AWS SDK

3. **桥接模式**
   - database/sql (Go 标准库)
   - JDBC (Java)

## 📞 常见问题

### Q1: 组合模式和装饰器模式有什么区别？

A1: 虽然两者结构相似，但意图不同：
- **组合模式**: 关注部分-整体层次结构，强调树形结构的统一处理
- **装饰器模式**: 关注动态添加职责，强调功能的扩展

### Q2: 外观模式会不会成为"上帝类"？

A2: 外观模式确实可能导致外观类过于庞大。解决方法：
- 将外观类拆分为多个更小的外观类
- 每个外观类负责一个特定的子系统集合
- 使用分层外观，高层外观调用低层外观

### Q3: 桥接模式和策略模式有什么区别？

A3: 两者都使用组合，但关注点不同：
- **桥接模式**: 关注抽象和实现的分离，处理多维度变化
- **策略模式**: 关注算法的封装和替换，处理单一维度的变化

### Q4: 什么时候使用组合模式？

A4: 当你需要：
- 表示对象的部分-整体层次结构
- 希望客户端统一对待单个对象和组合对象
- 需要递归组合对象

### Q5: Go 语言如何实现桥接模式？

A5: Go 语言通过接口和组合实现桥接模式：
- 使用接口定义实现层
- 抽象层持有接口类型的字段
- 通过依赖注入传入具体实现

## 🎓 下一步

完成本 Lab 后，你将掌握三种重要的结构型模式。接下来可以：

1. **继续学习**: 进入 [Lab 05: 行为型模式 - 策略、观察者、模板方法](../lab05-行为型模式-策略观察者模板/README.md)
2. **深入实践**: 在自己的项目中应用这些模式
3. **模式对比**: 回顾 Lab 03，对比六种结构型模式的异同
4. **综合应用**: 思考如何组合使用多个模式解决复杂问题

---

**提示**: 结构型模式关注如何组合类和对象以获得更大的结构。组合、外观、桥接这三个模式分别从不同角度解决结构问题，掌握它们将大大提升你的系统设计能力。
