# API 网关项目

## 项目背景

本项目实现一个简化的 API 网关，作为微服务架构的统一入口。使用外观模式封装多个后端微服务，为客户端提供简化的高层接口。

## 功能列表

- [x] 用户服务集成
- [x] 订单服务集成
- [x] 支付服务集成
- [x] 库存服务集成
- [x] 通知服务集成
- [x] 统一的用户信息查询
- [x] 完整的下单流程
- [x] 订单取消流程
- [x] 错误处理和重试
- [x] 请求日志记录

## 技术栈

- Go 1.21+
- 标准库

## 设计模式应用

| 模式 | 应用位置 | 作用 |
|------|----------|------|
| 外观模式 | APIGateway 类 | 简化微服务访问，提供统一入口 |

## 项目结构

```
api-gateway/
├── README.md           # 项目说明
├── main.go            # 主程序入口
├── gateway.go         # API 网关实现
└── gateway_test.go    # 测试文件
```

## 运行方式

```bash
# 运行程序
go run main.go gateway.go

# 运行测试
go test -v

# 运行测试并显示覆盖率
go test -v -cover
```

## 预期输出

```
=== API 网关项目 ===

场景 1: 获取用户完整信息
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  [UserService] 获取用户信息: user-123
  [OrderService] 获取用户订单: user-123
  [PaymentService] 获取支付历史: user-123
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 用户信息获取完成

场景 2: 下单流程
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  [UserService] 验证用户: user-123
  [InventoryService] 检查库存: [商品A 商品B]
  [InventoryService] 预留库存: [商品A 商品B]
  [OrderService] 创建订单: 用户=user-123
  [PaymentService] 处理支付: 订单=order-003, 金额=899.99
  [NotificationService] 发送邮件: 订单确认
  [NotificationService] 发送短信: 订单创建成功
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 订单创建成功: order-003

场景 3: 取消订单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  [UserService] 验证用户: user-123
  [PaymentService] 处理退款: 订单=order-003
  [InventoryService] 释放库存: 订单=order-003
  [NotificationService] 发送邮件: 订单取消
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 订单取消成功
```

## 扩展建议

1. **认证和授权**
   - JWT 令牌验证
   - OAuth2 集成
   - 权限控制

2. **限流和熔断**
   - 请求限流
   - 熔断器模式
   - 降级策略

3. **缓存**
   - Redis 缓存集成
   - 缓存策略
   - 缓存失效

4. **监控和日志**
   - 请求追踪
   - 性能监控
   - 错误日志

5. **负载均衡**
   - 服务发现
   - 负载均衡算法
   - 健康检查

6. **API 版本管理**
   - 版本路由
   - 向后兼容
   - 版本迁移
