# 练习 1: 实现文档审批流程

## 难度
⭐⭐ (中等)

## 学习目标
- 掌握责任链模式和状态模式的组合使用
- 理解如何设计多级审批流程
- 学会处理复杂的业务状态转换

## 问题描述

设计并实现一个文档审批系统，支持多级审批流程。文档有多个状态，需要经过不同级别的审批者审批。

## 功能要求

### 1. 文档状态
文档应该有以下状态：
- **草稿 (Draft)**: 初始状态，可以编辑
- **待审批 (Pending)**: 已提交，等待审批
- **审批中 (Reviewing)**: 正在审批过程中
- **已通过 (Approved)**: 审批通过
- **已拒绝 (Rejected)**: 审批被拒绝
- **已撤回 (Withdrawn)**: 申请人撤回

### 2. 审批者层级
实现以下审批者：
- **部门经理**: 可审批金额 < 1000 的文档
- **总监**: 可审批金额 < 5000 的文档
- **总经理**: 可审批金额 < 10000 的文档

### 3. 操作
文档应支持以下操作：
- `Submit()`: 提交审批
- `Approve(approver)`: 审批通过
- `Reject(approver, reason)`: 拒绝审批
- `Withdraw()`: 撤回申请
- `Edit()`: 编辑文档（仅草稿状态）

### 4. 审批规则
- 文档只能在草稿状态下提交
- 提交后自动进入审批链
- 审批者按权限审批，超出权限自动转交上级
- 任何审批者都可以拒绝
- 已通过或已拒绝的文档不能再次审批
- 只有待审批状态的文档可以撤回

## 输入输出示例

### 示例 1: 正常审批流程

**输入**:
```go
doc := NewDocument("DOC001", "采购申请", 800, "张三", "技术部")
doc.Submit()
manager.Approve(doc)
```

**输出**:
```
[文档 DOC001] 状态变更: 草稿 -> 待审批
[部门经理] 审批文档: 采购申请 (金额: 800 元)
[部门经理] ✓ 审批通过
[文档 DOC001] 状态变更: 待审批 -> 已通过
```

### 示例 2: 多级审批

**输入**:
```go
doc := NewDocument("DOC002", "设备采购", 3500, "李四", "市场部")
doc.Submit()
manager.Approve(doc)
```

**输出**:
```
[文档 DOC002] 状态变更: 草稿 -> 待审批
[部门经理] 审批文档: 设备采购 (金额: 3500 元)
[部门经理] 金额超出权限，转交上级
[总监] 审批文档: 设备采购 (金额: 3500 元)
[总监] ✓ 审批通过
[文档 DOC002] 状态变更: 待审批 -> 已通过
```

### 示例 3: 审批被拒绝

**输入**:
```go
doc := NewDocument("DOC003", "差旅费用", 2000, "王五", "销售部")
doc.Submit()
director.Reject(doc, "预算不足")
```

**输出**:
```
[文档 DOC003] 状态变更: 草稿 -> 待审批
[总监] 审批文档: 差旅费用 (金额: 2000 元)
[总监] ✗ 拒绝审批，原因: 预算不足
[文档 DOC003] 状态变更: 待审批 -> 已拒绝
```

## 提示

💡 **提示 1**: 使用状态模式管理文档的状态转换，每个状态类实现不同的操作行为。

💡 **提示 2**: 使用责任链模式组织审批者，每个审批者根据权限决定是否处理或转交。

💡 **提示 3**: 在文档类中维护审批历史，记录每次状态变更和审批操作。

💡 **提示 4**: 考虑使用接口定义状态和审批者的行为，便于扩展。

💡 **提示 5**: 注意处理边界情况，如重复提交、非法状态转换等。

## 评分标准

- [ ] **功能完整性 (40%)**
  - 实现所有要求的状态
  - 实现所有要求的操作
  - 正确处理审批流程

- [ ] **代码质量 (30%)**
  - 代码结构清晰
  - 命名规范
  - 适当的注释

- [ ] **设计模式应用 (20%)**
  - 正确使用状态模式
  - 正确使用责任链模式
  - 模式组合合理

- [ ] **错误处理 (10%)**
  - 处理非法操作
  - 提供清晰的错误信息
  - 边界情况处理

## 扩展挑战

如果你完成了基本要求，可以尝试以下扩展功能：

1. **并行审批**: 支持多个审批者同时审批，所有人通过才算通过
2. **条件审批**: 根据文档类型或部门设置不同的审批流程
3. **审批时限**: 设置审批时限，超时自动提醒或转交
4. **审批委托**: 审批者可以委托他人代为审批
5. **审批历史查询**: 提供审批历史的查询和统计功能

## 参考资源

- 状态模式理论文档: `theory/01-state.md`
- 责任链模式理论文档: `theory/03-chain.md`
- 订单状态机示例: `examples/state/order_state.go`
- 审批流程示例: `examples/chain/approval_chain.go`
