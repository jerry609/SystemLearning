# 任务调度器项目

## 项目背景

本项目实现了一个任务调度系统，使用命令模式封装任务，支持任务的提交、执行、撤销和重做。系统支持优先级队列、任务历史记录和任务状态管理。

## 功能列表

- [x] 任务提交和执行
- [x] 任务撤销和重做
- [x] 优先级队列
- [x] 任务历史记录
- [x] 任务状态管理
- [x] 批量任务执行
- [x] 任务失败重试
- [x] 任务超时处理

## 技术栈

- Go 1.21+
- 标准库 testing（单元测试）

## 设计模式应用

| 模式 | 应用位置 | 作用 |
|------|----------|------|
| 命令模式 | Task 接口及实现 | 封装任务操作，支持撤销重做 |
| 责任链模式 | TaskFilter | 任务过滤和验证 |

## 项目结构

```
task-scheduler/
├── README.md           # 项目说明
├── main.go            # 主程序入口和示例
├── scheduler.go       # 调度器实现
└── scheduler_test.go  # 单元测试
```

## 任务类型

### 1. 数据处理任务
- 数据导入
- 数据导出
- 数据转换

### 2. 通知任务
- 发送邮件
- 发送短信
- 推送通知

### 3. 维护任务
- 数据库备份
- 日志清理
- 缓存刷新

## 运行方式

### 运行主程序

```bash
go run main.go scheduler.go
```

### 运行测试

```bash
go test -v
```

### 运行测试并查看覆盖率

```bash
go test -v -cover
```

## 预期输出

```
=== 任务调度器系统 ===

--- 场景1: 基本任务执行 ---
[调度器] 提交任务: 发送邮件
[调度器] 提交任务: 数据备份
[调度器] 提交任务: 生成报告

[调度器] 执行任务: 发送邮件
[邮件任务] 发送邮件到 user@example.com
[邮件任务] ✓ 邮件发送成功

[调度器] 执行任务: 数据备份
[备份任务] 备份数据库 production
[备份任务] ✓ 备份完成

...
```

## 核心代码说明

### 任务接口

```go
type Task interface {
    Execute() error
    Undo() error
    String() string
    GetPriority() int
}
```

### 调度器

```go
type Scheduler struct {
    queue   []Task
    history []Task
    current int
}
```

## 扩展建议

1. **定时任务**: 支持 cron 表达式定时执行任务
2. **分布式调度**: 支持多节点分布式任务调度
3. **任务依赖**: 支持任务之间的依赖关系
4. **任务监控**: 实时监控任务执行状态
5. **任务持久化**: 将任务保存到数据库
6. **任务通知**: 任务完成后发送通知
7. **任务重试**: 失败任务自动重试
8. **任务限流**: 限制并发执行的任务数量

## 学习要点

1. **命令模式的应用**: 理解如何使用命令模式封装任务
2. **撤销重做机制**: 掌握撤销重做的实现原理
3. **优先级队列**: 理解优先级队列的实现
4. **任务状态管理**: 学会管理任务的生命周期

## 参考资源

- 命令模式理论: `../../theory/02-command.md`
- 任务队列示例: `../../examples/command/task_queue.go`
- 撤销重做示例: `../../examples/command/undo_redo.go`
